import { Grid } from '@mantine/core';
import Head from 'next/head';
import React, { useEffect, useState } from "react";
import MovieCard from "../../components/MovieCard/MovieCard";
import { useAuth } from "../../lib/firebase.auth";
import { getMovies } from "../../lib/firebase.db";
import { Movie } from "../../lib/interfaces";
import styles from '../../styles/Home.module.css';

export default function Watchlist() {

  const { user } = useAuth();
  const [movies, setMovies] = useState<Movie[]>([]);
  useEffect(() => {
    if (user) {
      getMovies(user.watchlist).then((data) => setMovies(data))
    }
  }, [user]);

  return (
    <div className={styles.container}>
      <Head>
        <title>Watchlist | Five Stars</title>
        <meta name="description" content="Generated by create next app"/>
        <link rel="icon" href="/favicon.ico"/>
      </Head>

      <main className={styles.main}>
        <h1 className={styles.title}>
          Watchlist
        </h1>

        <Grid gutter="lg">
          {movies.map(movie => (
            <Grid.Col sm={6} lg={4} key={movie.id}>
              <MovieCard movie={movie} user={user}/>
            </Grid.Col>
          ))}
        </Grid>
      </main>
    </div>
  )
}
